<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title data-i18n="login.title">X</title>
    <style>.precheck-hide body{ visibility: hidden; }</style>
    <script>
      
      (function(){
        try{
          var hasToken = document.cookie.split(';').some(function(c){ 
            return c.trim().indexOf('iding-session=') === 0; 
          });
          if (hasToken){
     
            location.replace('/');
            return;
          }
          
     
          fetch('/api/session', { 
            method: 'GET', 
            headers: { 'Cache-Control': 'no-cache' },
            credentials: 'include'
          }).then(function(r){
            if (r && r.ok){
              location.replace('/');
            }
          }).catch(function(){ 

          });
        }catch(_){ 

        }
      })();
    </script>
    <script src="/js/auth-guard.js"></script>
    <script>
 
      (function(){
        try{ document.documentElement.classList.add('precheck-hide'); }catch(_){ }
        try{
          var u = new URL(location.href);
          var fromLogout = (u.searchParams.get('from') === 'logout') || (sessionStorage.getItem('mf:just_logged_out') === '1');
          if (fromLogout){
            sessionStorage.removeItem('mf:just_logged_out');
            document.documentElement.classList.remove('precheck-hide');
            return;
          }
        }catch(_){ }

        try{
          var controller = new AbortController();
          var tid = setTimeout(function(){ try{ controller.abort(); }catch(_){ } }, 500);
          fetch('/api/session', { headers: { 'Cache-Control': 'no-cache' }, signal: controller.signal })
            .then(function(r){
              clearTimeout(tid);
              if (r && r.ok){ location.replace('/'); return; }
              document.documentElement.classList.remove('precheck-hide');
            })
            .catch(function(){ try{ document.documentElement.classList.remove('precheck-hide'); }catch(_){ } });
        }catch(_){ try{ document.documentElement.classList.remove('precheck-hide'); }catch(_){ } }
        // ÊúÄÈïø 1s ÂÖúÂ∫ïÊòæÁ§∫
        setTimeout(function(){ try{ document.documentElement.classList.remove('precheck-hide'); }catch(_){ } }, 1000);
      })();
    </script>
    
    <script src="/js/mock.js"></script>
    <link rel="icon" href="favicon.svg" type="image/svg+xml" />
    <link rel="shortcut icon" href="favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="/css/login.css" />
    <script src="/js/i18n.js"></script>
  </head>
  <body>
    <div class="bg"></div>
    <div class="center">
      <div class="card">
        <div class="logo">üîê</div>
        <h1 data-i18n="login.loginWithEmail">LOGIN WITH EMAIL</h1>
        <div id="err" class="err"></div>
        <input id="username" class="input" type="text" data-i18n-placeholder="login.usernamePlaceholder" placeholder="Áî®Êà∑Âêç/ÈÇÆÁÆ±" />
        <input id="pwd" class="input" type="password" data-i18n-placeholder="login.passwordPlaceholder" placeholder="ÂØÜÁ†Å" />
        <div style="font-size:12px;color:#64748b;margin-bottom:8px">
        </div>
        <button id="login" class="btn" data-i18n="login.signIn">Sign In</button>
      </div>
    </div>
    
    <!-- Language Switcher -->
    <div style="position: fixed; top: 20px; right: 20px; z-index: 1000;">
      <button id="language-switcher" class="btn btn-ghost" title="Switch Language" style="background: rgba(255,255,255,0.9); border: 1px solid rgba(0,0,0,0.1); padding: 8px 16px; border-radius: 6px; font-size: 14px;">
        <span class="btn-text">English</span>
      </button>
    </div>
    <script src="/js/login.js"></script>
  </body>
  </html>

